version: "3.0"

services:
  crawler:
    image: io.github.samwright.nhs/crawler:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
      - eureka.client.refresh.interval=1
      - eureka.appinfo.replicate.interval=1
      - eureka.serviceUrlPollIntervalMs=1000
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/crawler/status"]
      interval: 30s
      timeout: 10s
      retries: 10
    depends_on:
      - "eureka"

  searcher:
    image: io.github.samwright.nhs/searcher:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
      - eureka.client.refresh.interval=1
      - eureka.appinfo.replicate.interval=1
      - eureka.serviceUrlPollIntervalMs=1000
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/search/status"]
      interval: 30s
      timeout: 10s
      retries: 10
    depends_on:
      - "eureka"

  pages:
    image: io.github.samwright.nhs/pages:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
      - eureka.client.refresh.interval=1
      - eureka.appinfo.replicate.interval=1
      - eureka.serviceUrlPollIntervalMs=1000
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/page"]
      interval: 30s
      timeout: 10s
      retries: 10
    depends_on:
      - "eureka"

  eureka:
    image: io.github.samwright.nhs/eureka:@project.version@
    ports:
      - "8761"
    environment:
      - eureka.client.refresh.interval=1
      - eureka.appinfo.replicate.interval=1
      - eureka.serviceUrlPollIntervalMs=1000
    hostname: eureka
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761"]
      interval: 30s
      timeout: 10s
      retries: 10

  zuul:
    image: io.github.samwright.nhs/zuul:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/page"]
      interval: 30s
      timeout: 10s
      retries: 10
    depends_on:
      - "eureka"
      - "pages"
      - "crawler"
      - "searcher"
