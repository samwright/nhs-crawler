version: "3.0"

services:
  crawler:
    image: io.github.samwright.nhs/crawler:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
    healthcheck:
      test: ["CMD", "/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 5

  searcher:
    image: io.github.samwright.nhs/searcher:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
    healthcheck:
      test: ["CMD", "/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 5

  pages:
    image: io.github.samwright.nhs/pages:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
    healthcheck:
      test: ["CMD", "/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 5

  eureka:
    image: io.github.samwright.nhs/eureka:@project.version@
    ports:
      - "8761"
    hostname: eureka
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761"]
      interval: 30s
      timeout: 10s
      retries: 5

  zuul:
    image: io.github.samwright.nhs/zuul:@project.version@
    ports:
      - "8080"
    environment:
      - EUREKA_HOST=eureka
    healthcheck:
      test: ["CMD", "/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 5
